<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Usage · Measurements</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Measurements</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Introduction</a></li><li><a class="toctext" href="../installation/">Installation</a></li><li class="current"><a class="toctext" href>Usage</a><ul class="internal"><li><a class="toctext" href="#Correlation-Between-Variables-1">Correlation Between Variables</a></li><li><a class="toctext" href="#Propagate-Uncertainty-for-Arbitrary-Functions-1">Propagate Uncertainty for Arbitrary Functions</a></li><li><a class="toctext" href="#Derivative-and-Gradient-1">Derivative and Gradient</a></li><li><a class="toctext" href="#Uncertainty-Contribution-1">Uncertainty Contribution</a></li><li><a class="toctext" href="#Standard-Score-1">Standard Score</a></li><li><a class="toctext" href="#Weighted-Average-1">Weighted Average</a></li><li><a class="toctext" href="#Access-Nominal-Value-and-Uncertainty-1">Access Nominal Value and Uncertainty</a></li><li><a class="toctext" href="#Error-Propagation-of-Numbers-with-Units-1">Error Propagation of Numbers with Units</a></li><li><a class="toctext" href="#Representation-of-Measurements-1">Representation of <code>Measurement</code>s</a></li></ul></li><li><a class="toctext" href="../examples/">Examples</a></li><li><a class="toctext" href="../performance/">Performance</a></li><li><a class="toctext" href="../todo/">Development</a></li><li><a class="toctext" href="../appendix/">Appendix</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Usage</a></li></ul><a class="edit-page" href="https://github.com/JuliaPhysics/Measurements.jl/blob/master/docs/src/usage.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Usage</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Usage-1" href="#Usage-1">Usage</a></h1><p>After installing the package, you can start using it with</p><pre><code class="language-julia">using Measurements</code></pre><p>The module defines a new <code>Measurement</code> data type. <code>Measurement</code> objects can be created with the two following constructors:</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Measurements.measurement" href="#Measurements.measurement"><code>Measurements.measurement</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">measurement(val::Real, [err::Real]) -&gt; Measurement
val ± err -&gt; Measurement</code></pre><p>Return a <code>Measurement</code> object with <code>val</code> as nominal value and <code>err</code> as uncertainty.  <code>err</code> defaults to 0 if omitted.</p><p>The binary operator <code>±</code> is equivalent to <code>measurement</code>, so you can construct a <code>Measurement</code> object by explicitely writing <code>123 ± 4</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaPhysics/Measurements.jl/blob/a6e3bef034c6ec849bf4700ce8e251b70286a98b/src/Measurements.jl#L95-L104">source</a></section><p>where</p><ul><li><code>val</code> is the nominal value of the measurement</li><li><code>err</code> is its uncertainty, assumed to be a <a href="https://en.wikipedia.org/wiki/Standard_deviation">standard deviation</a>.</li></ul><p>They are both subtype of <code>AbstractFloat</code>. Some keyboard layouts provide an easy way to type the <code>±</code> sign, if your does not, remember you can insert it in Julia REPL with <code>\pm</code> followed by <code>TAB</code> key. You can provide <code>val</code> and <code>err</code> of any subtype of <code>Real</code> that can be converted to <code>AbstractFloat</code>. Thus, <code>measurement(42, 33//12)</code> and <code>pi ± 0.1</code> are valid.</p><p><code>measurement(value)</code> creates a <code>Measurement</code> object with zero uncertainty, like mathematical constants. See below for further examples.</p><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"><p>Every time you use one of the constructors above you define a <em>new independent</em> measurement. Instead, when you perform mathematical operations involving <code>Measurement</code> objects you create a quantity that is not independent, but rather depends on really independent measurements.</p></div></div><p>Most mathematical operations are instructed, by <a href="https://en.wikipedia.org/wiki/Operator_overloading">operator overloading</a>, to accept <code>Measurement</code> type, and uncertainty is calculated exactly using analityc expressions of functions&#39; derivatives.</p><p>It is also possible to create a <code>Complex</code> measurement with</p><pre><code class="language-julia">complex(measurement(real_part_value, real_part_uncertainty),
        measurement(imaginary_part_value, imaginary_part_uncertainty))</code></pre><p>In addition to making the code prettier, the fact that the <code>±</code> sign can be used as infix operator to define new independent <code>Measurement</code> s makes the printed representation of these objects valid Julia syntax, so you can quickly copy the output of an operation in the Julia REPL to perform other calculations. Note however that the copied number will not be the <em>same</em> object as the original one, because it will be a <em>new independent</em> measurement, without memory of the correlations of the original object.</p><p>This module extends many methods defined in Julia&#39;s mathematical standard library, and some methods from widespread third-party packages as well. This is the case for most special functions in <a href="https://github.com/JuliaMath/SpecialFunctions.jl">SpecialFunctions.jl</a> package, and the <code>quadgk</code> integration routine from <a href="https://github.com/JuliaMath/QuadGK.jl">QuadGK.jl</a> package.</p><p>Those interested in the technical details of the package, in order integrate the package in their workflow, can have a look at the <a href="#Appendix:-Technical-Details-1">technical appendix</a>.</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Measurements.measurement-Tuple{AbstractString}" href="#Measurements.measurement-Tuple{AbstractString}"><code>Measurements.measurement</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-none">measurement(string) -&gt; Measurement{Float64}</code></pre><p>Parse the string and return a <code>Measurement{Float64}</code> object.</p><p>Examples of valid strings and the resulting <code>Measurement{Float64}</code> are:</p><pre><code class="language-julia-repl">julia&gt; measurement(&quot;-123.4(56)&quot;)
-123.4 ± 5.6

julia&gt; measurement(&quot;+1234(56)e-1&quot;)
123.4 ± 5.6

julia&gt; measurement(&quot;12.34e-1 +- 0.56e1&quot;)
1.2 ± 5.6

julia&gt; measurement(&quot;(-1.234 ± 0.056)e2&quot;)
-123.4 ± 5.6

julia&gt; measurement(&quot;1234e-1 +/- 5.6e0&quot;)
123.4 ± 5.6

julia&gt; measurement(&quot;-1234e-1&quot;)
-123.4 ± 0.0</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaPhysics/Measurements.jl/blob/a6e3bef034c6ec849bf4700ce8e251b70286a98b/src/parsing.jl#L54-L80">source</a></section><p><code>measurement</code> function has also a method that enables you to create a <code>Measurement</code> object from a string.</p><div class="admonition warning"><div class="admonition-title">Caveat about the ± sign</div><div class="admonition-text"><p>The <code>±</code> infix operator is a convenient symbol to define quantities with uncertainty, but can lead to unexpected results if used in elaborate expressions involving many <code>±</code>s. Use parantheses where appropriate to avoid confusion. See for example the following cases:</p><pre><code class="language-julia-repl">julia&gt; 7.5±1.2 + 3.9±0.9 # This is wrong!
11.4 ± 1.2 ± 0.9 ± 0.0

julia&gt; (7.5±1.2) + (3.9±0.9) # This is correct
11.4 ± 1.5</code></pre></div></div><h2><a class="nav-anchor" id="Correlation-Between-Variables-1" href="#Correlation-Between-Variables-1">Correlation Between Variables</a></h2><p>The fact that two or more measurements are correlated means that there is some sort of relationship beetween them. In the context of measurements and error propagation theory, the term &quot;<a href="https://en.wikipedia.org/wiki/Correlation_and_dependence">correlation</a>&quot; is very broad and can indicate different things. Among others, there may be some dependence between uncertainties of different measurements with different values, or a dependence between the values of two measurements while their uncertainties are different.</p><p>Here, for correlation we mean the most simple case of functional relationship: if <span>$x = \bar{x} \pm \sigma_x$</span> is an independent measurement, a quantity <span>$y = f(x) = \bar{y} \pm \sigma_y$</span> that is function of <span>$x$</span> is not like an independent measurement but is a quantity that depends on <span>$x$</span>, so we say that <span>$y$</span> is correlated with <span>$x$</span>. The package <code>Measurements.jl</code> is able to handle this type of correlation when propagating the uncertainty for operations and functions taking two or more arguments. As a result, <span>$x - x = 0 \pm 0$</span> and <span>$x/x = 1 \pm 0$</span>.  If this correlation was not accounted for, you would always get non-zero uncertainties even for these operations that have exact results. Two truly different measurements that only by chance share the same nominal value and uncertainty are not treated as correlated.</p><h2><a class="nav-anchor" id="Propagate-Uncertainty-for-Arbitrary-Functions-1" href="#Propagate-Uncertainty-for-Arbitrary-Functions-1">Propagate Uncertainty for Arbitrary Functions</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Measurements.@uncertain" href="#Measurements.@uncertain"><code>Measurements.@uncertain</code></a> — <span class="docstring-category">Macro</span>.</div><div><div><pre><code class="language-none">@uncertain f(value ± stddev, ...)</code></pre><p>A macro to calculate <code>f(value) ± uncertainty</code>, with <code>uncertainty</code> derived from <code>stddev</code> according to rules of linear error propagation theory.</p><p>Function <code>f</code> can accept any number of real arguments.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaPhysics/Measurements.jl/blob/a6e3bef034c6ec849bf4700ce8e251b70286a98b/src/math.jl#L142-L149">source</a></section><p>Existing functions implemented exclusively in Julia that accept <code>AbstractFloat</code> arguments will work out-of-the-box with <code>Measurement</code> objects as long as they internally use functions already supported by this package. However, there are functions that take arguments that are specific subtypes of <code>AbstractFloat</code>, or are implemented in such a way that does not play nicely with <code>Measurement</code> variables.</p><p>The package provides the <code>@uncertain</code> macro that overcomes this limitation and further extends the power of <code>Measurements.jl</code>.</p><p>This macro allows you to propagate uncertainty in arbitrary functions, including those based on <a href="https://docs.julialang.org/en/v1/manual/calling-c-and-fortran-code/">C/Fortran calls</a>, that accept any number of real arguments. The macro exploits <code>derivative</code> and <code>gradient</code> functions from <a href="https://github.com/JuliaMath/Calculus.jl">Calculus</a> package in order to perform numerical differentiation.</p><h2><a class="nav-anchor" id="Derivative-and-Gradient-1" href="#Derivative-and-Gradient-1">Derivative and Gradient</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Measurements.derivative" href="#Measurements.derivative"><code>Measurements.derivative</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">derivative(x::Measurement, y::Measurement)</code></pre><p>Return the value of the partial derivative of <code>x</code> with respect to the independent measurement <code>y</code>, calculated on the nominal value of <code>y</code>.  Return zero if <code>x</code> does not depend on <code>y</code>.</p><p>Use <code>Measurements.derivative.(x, array)</code> to calculate the gradient of <code>x</code> with respect to an array of independent measurements.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaPhysics/Measurements.jl/blob/a6e3bef034c6ec849bf4700ce8e251b70286a98b/src/utils.jl#L62-L71">source</a></section><p>In order to propagate the uncertainties, <code>Measurements.jl</code> keeps track of the partial derivative of an expression with respect to all independent measurements from which the expression comes. For this reason, the package provides a convenient function, <code>Measurements.derivative</code>, to get the partial derivative and the gradient of an expression with respect to independent measurements.</p><h2><a class="nav-anchor" id="Uncertainty-Contribution-1" href="#Uncertainty-Contribution-1">Uncertainty Contribution</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Measurements.uncertainty_components" href="#Measurements.uncertainty_components"><code>Measurements.uncertainty_components</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">Measurements.uncertainty_components(x::Measurement)</code></pre><p>Return the components to the uncertainty of the dependent quantity <code>x</code> in the form of a <code>Dict</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaPhysics/Measurements.jl/blob/a6e3bef034c6ec849bf4700ce8e251b70286a98b/src/utils.jl#L101-L106">source</a></section><p>You may want to inspect which measurement contributes most to the total uncertainty of a derived quantity, in order to minimize it, if possible.  The function <code>Measurements.uncertainty_components</code> gives you a dictonary whose values are the components of the uncertainty of <code>x</code>.</p><h2><a class="nav-anchor" id="Standard-Score-1" href="#Standard-Score-1">Standard Score</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Measurements.stdscore" href="#Measurements.stdscore"><code>Measurements.stdscore</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">stdscore(measure::Measurement, expected_value::Real) -&gt; standard_score</code></pre><p>Gives the standard score between a measure, with uncertainty, and its expected value:</p><pre><code class="language-none">(measure.val - expected_value)/measure.err</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaPhysics/Measurements.jl/blob/a6e3bef034c6ec849bf4700ce8e251b70286a98b/src/utils.jl#L22-L29">source</a><div><div><pre><code class="language-none">stdscore(measure_1::Measurement, measure_2::Measurement) -&gt; standard_score</code></pre><p>Gives the standard score between two measurements (both with uncertainty) computed as the standard score between their difference and 0:</p><pre><code class="language-none">stdscore(measure_1 - measure_2, 0)</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaPhysics/Measurements.jl/blob/a6e3bef034c6ec849bf4700ce8e251b70286a98b/src/utils.jl#L32-L39">source</a></section><p>The <code>stdscore</code> function is available to calculate the <a href="https://en.wikipedia.org/wiki/Standard_score">standard score</a> between a measurement and its expected value (not a <code>Measurement</code>). When both arguments are <code>Measurement</code> objects, the standard score between their difference and zero is computed, in order to test their compatibility.</p><h2><a class="nav-anchor" id="Weighted-Average-1" href="#Weighted-Average-1">Weighted Average</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Measurements.weightedmean" href="#Measurements.weightedmean"><code>Measurements.weightedmean</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">weightedmean(iterable) -&gt; measurement(weighted_mean, standard_deviation)</code></pre><p>Return the weighted mean of measurements listed in <code>iterable</code>, using inverse-variance weighting.  NOTA BENE: correlation is not taken into account.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaPhysics/Measurements.jl/blob/a6e3bef034c6ec849bf4700ce8e251b70286a98b/src/utils.jl#L44-L49">source</a></section><p><code>weightedmean</code> function gives the <a href="https://en.wikipedia.org/wiki/Weighted_arithmetic_mean">weighted mean</a> of a set of measurements using <a href="https://en.wikipedia.org/wiki/Inverse-variance_weighting">inverses of variances as weights</a>. Use <code>mean</code> for the simple arithmetic mean.</p><h2><a class="nav-anchor" id="Access-Nominal-Value-and-Uncertainty-1" href="#Access-Nominal-Value-and-Uncertainty-1">Access Nominal Value and Uncertainty</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Measurements.value" href="#Measurements.value"><code>Measurements.value</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">Measurements.value(x::Measurement)
Measurements.value(x::Complex{Measurement})</code></pre><p>Return the nominal value of measurement <code>x</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaPhysics/Measurements.jl/blob/a6e3bef034c6ec849bf4700ce8e251b70286a98b/src/utils.jl#L85-L90">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Measurements.uncertainty" href="#Measurements.uncertainty"><code>Measurements.uncertainty</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">Measurements.uncertainty(x::Measurement)
Measurements.uncertainty(x::Complex{Measurement})</code></pre><p>Return the uncertainty of measurement <code>x</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaPhysics/Measurements.jl/blob/a6e3bef034c6ec849bf4700ce8e251b70286a98b/src/utils.jl#L93-L98">source</a></section><p>As explained in the technical appendix, the nominal value and the uncertainty of <code>Measurement</code> objects are stored in <code>val</code> and <code>err</code> fields respectively, but you do not need to use those field directly to access this information. Functions <code>Measurements.value</code> and <code>Measurements.uncertainty</code> allow you to get the nominal value and the uncertainty of <code>x</code>, be it a single measurement or an array of measurements. They are particularly useful in the case of complex measurements or arrays of measurements.</p><h2><a class="nav-anchor" id="Error-Propagation-of-Numbers-with-Units-1" href="#Error-Propagation-of-Numbers-with-Units-1">Error Propagation of Numbers with Units</a></h2><p><code>Measurements.jl</code> does not know about <a href="https://en.wikipedia.org/wiki/Units_of_measurement">units of measurements</a>, but can be easily employed in combination with other Julia packages providing this feature. Thanks to the <a href="https://docs.julialang.org/en/v1/manual/types/">type system</a> of Julia programming language this integration is seamless and comes for free, no specific work has been done by the developer of the present package nor by the developers of the above mentioned packages in order to support their interplay. They all work equally good with <code>Measurements.jl</code>, you can choose the library you prefer and use it. Note that only <a href="https://en.wikipedia.org/wiki/Algebraic_operation">algebraic functions</a> are allowed to operate with numbers with units of measurement, because <a href="https://en.wikipedia.org/wiki/Transcendental_function">transcendental functions</a> operate on <a href="https://en.wikipedia.org/wiki/Dimensionless_quantity">dimensionless quantities</a>. In the Examples section you will find how this feature works with a couple of packages.</p><h2><a class="nav-anchor" id="Representation-of-Measurements-1" href="#Representation-of-Measurements-1">Representation of <code>Measurement</code>s</a></h2><h3><a class="nav-anchor" id="Measurements-in-the-REPL-1" href="#Measurements-in-the-REPL-1"><code>Measurement</code>s in the REPL</a></h3><p>When working in the <a href="https://docs.julialang.org/en/v1/stdlib/REPL/">Julia REPL</a>, <code>Measurement</code> objects are shown truncated in order to present two significant digits for the uncertainty:</p><pre><code class="language-julia-repl">julia&gt; -84.32 ± 5.6
-84.3 ± 5.6

julia&gt; 7.9 ± 18.6
8.0 ± 19.0</code></pre><p>Note that truncation only affects the numbers shown in the REPL:</p><pre><code class="language-julia-repl">julia&gt; Measurements.value(7.9 ± 18.6)
7.9

julia&gt; Measurements.uncertainty(7.9 ± 18.6)
18.6</code></pre><h3><a class="nav-anchor" id="Printing-to-TeX-and-LaTeX-MIMEs-1" href="#Printing-to-TeX-and-LaTeX-MIMEs-1">Printing to TeX and LaTeX MIMEs</a></h3><p>You can print <code>Measurement</code> objects to TeX and LaTeX MIMES (<code>&quot;text/x-tex&quot;</code> and <code>&quot;text/x-latex&quot;</code>), the <code>±</code> sign will be rendered with <code>\pm</code> command:</p><pre><code class="language-julia-repl">julia&gt; repr(&quot;text/x-tex&quot;, 5±1)
&quot;5.0 \\pm 1.0&quot;

julia&gt; repr(&quot;text/x-latex&quot;, pi ± 1e-3)
&quot;3.1416 \\pm 0.001&quot;</code></pre><footer><hr/><a class="previous" href="../installation/"><span class="direction">Previous</span><span class="title">Installation</span></a><a class="next" href="../examples/"><span class="direction">Next</span><span class="title">Examples</span></a></footer></article></body></html>
